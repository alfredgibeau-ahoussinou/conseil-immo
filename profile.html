<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil - ImmoConseil</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="connexion.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        body {
            padding-top: 60px;
            background-color: #f4f4f4;
        }

        .dashboard-header {
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 0.5rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            padding: 5px 10px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #3498db;
        }

        .nav-links a.active {
            color: #3498db;
            font-weight: bold;
        }

        .profile-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 20px;
        }

        .profile-section {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }

        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: bold;
            color: #333;
        }

        .form-group input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .save-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .save-button:hover {
            background-color: #2980b9;
        }

        .success-message {
            display: none;
            background-color: #2ecc71;
            color: white;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .profile-container {
                padding: 10px;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .nav-links {
                display: none;
            }

            .nav-links.show {
                display: flex;
                flex-direction: column;
                position: absolute;
                top: 60px;
                left: 0;
                right: 0;
                background-color: white;
                padding: 10px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

            .menu-toggle {
                display: block;
                font-size: 1.5rem;
                cursor: pointer;
            }

            .menu-toggle {
                display: none;
                font-size: 1.2rem;
                cursor: pointer;
                padding: 4px 8px;
                border-radius: 4px;
                transition: background-color 0.3s;
            }

            @media (max-width: 768px) {
                .menu-toggle {
                    display: block;
                    font-size: 1rem;
                    padding: 3px 6px;
                }

                .nav-container {
                    padding: 0.3rem;
                }

                .logo img {
                    height: 25px;
                }

                .nav-links.show {
                    top: 45px;
                }

                .dashboard-header {
                    padding: 0.3rem;
                }

                body {
                    padding-top: 45px;
                }

                .nav-links {
                    display: none;
                }

                .nav-links.show {
                    display: flex;
                    flex-direction: column;
                    position: absolute;
                    left: 0;
                    right: 0;
                    background-color: white;
                    padding: 8px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                }

                .nav-links a {
                    padding: 8px;
                    text-align: center;
                }

                .profile-container {
                    margin-top: 1rem;
                }

                .profile-header {
                    padding: 0.8rem;
                }

                .profile-avatar {
                    width: 80px;
                    height: 80px;
                    font-size: 32px;
                }
            }
        }
    </style>
</head>
<body>
    <header class="dashboard-header">
        <nav class="nav-container">
            <div class="logo">
                <img src="Vista Logos/logo-transparent-png.png" alt="ImmoConseil Logo" style="height: 40px;">
            </div>
            <div class="nav-links">
                <a href="dashboard.html">Tableau de bord</a>
                <a href="profile.html" class="active">Profil</a>
            </div>
        </nav>
    </header>

    <main class="profile-container">
        <section class="profile-section">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <h1>Mon Profil</h1>
                    <p id="userEmail"></p>
                </div>
            </div>

            <form id="profileForm" class="profile-form">
                <div class="form-group">
                    <label for="displayName">Nom d'utilisateur</label>
                    <input type="text" id="displayName" name="displayName">
                </div>
                <div class="form-group">
                    <label for="phone">Téléphone</label>
                    <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group">
                    <label for="address">Adresse</label>
                    <input type="text" id="address" name="address">
                </div>
                <button type="submit" class="save-button">Enregistrer les modifications</button>
            </form>

            <div id="successMessage" class="success-message">
                Profil mis à jour avec succès !
            </div>
        </section>
    </main>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAo--IEnTiD8deRZp5zHIcOR96uyZgJh4s",
            authDomain: "immoconseil-30825.firebaseapp.com",
            projectId: "immoconseil-30825",
            storageBucket: "immoconseil-30825.appspot.com",
            messagingSenderId: "468039815768",
            appId: "1:468039815768:web:3d102a3f68f86068d8f02d",
            measurementId: "G-3N3XRK2SP3"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Vérifier l'authentification
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('userEmail').textContent = user.email;
                loadUserProfile(user.uid);
            } else {
                window.location.href = 'connexion.html';
            }
        });

        // Charger le profil utilisateur
        function loadUserProfile(userId) {
            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('displayName').value = data.displayName || '';
                        document.getElementById('phone').value = data.phone || '';
                        document.getElementById('address').value = data.address || '';
                    }
                })
                .catch((error) => {
                    console.error("Erreur lors du chargement du profil:", error);
                });
        }

        // Gérer la soumission du formulaire
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const userId = auth.currentUser.uid;
            const userData = {
                displayName: document.getElementById('displayName').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                updatedAt: new Date()
            };

            db.collection('users').doc(userId).set(userData, { merge: true })
                .then(() => {
                    const successMessage = document.getElementById('successMessage');
                    successMessage.style.display = 'block';
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                })
                .catch((error) => {
                    console.error("Erreur lors de la mise à jour du profil:", error);
                    alert("Une erreur s'est produite lors de la mise à jour du profil.");
                });
        });

        // Ajouter la gestion du menu mobile
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelector('.nav-links');
            
            // Créer le bouton de menu hamburger
            const menuToggle = document.createElement('div');
            menuToggle.className = 'menu-toggle';
            menuToggle.innerHTML = '☰';
            document.querySelector('.nav-container').insertBefore(menuToggle, navLinks);

            menuToggle.addEventListener('click', function() {
                navLinks.classList.toggle('show');
                this.innerHTML = navLinks.classList.contains('show') ? '✕' : '☰';
            });

            // Fermer le menu quand on clique sur un lien
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', function() {
                    navLinks.classList.remove('show');
                    menuToggle.innerHTML = '☰';
                });
            });

            // Fermer le menu quand on clique en dehors
            document.addEventListener('click', function(event) {
                if (!navLinks.contains(event.target) && !menuToggle.contains(event.target)) {
                    navLinks.classList.remove('show');
                    menuToggle.innerHTML = '☰';
                }
            });
        });
    </script>
</body>
</html>
